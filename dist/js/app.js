var app=angular.module("tabataApp",[]);app.controller("tabataAppCtrl",["$scope",function($scope){function parseTime(e){var e=e.split(":"),t=parseInt(e[1]),s=parseInt(e[0]);return[s,t]}function minTwoDigits(e){return(e<10?"0":"")+e}function makeSound(e){if(e>=2){new buzz.sound("dist/buzz/beep-07.mp3").play()}else{new buzz.sound("dist/buzz/beep-08b.mp3").play()}}function switchScreens(e){"toWork"===e?($("#time-left").removeClass("hidden"),$("#break-left").addClass("hidden"),$("#current-timer").css("background-color","#a5d6a7"),$scope.timerStates.workRunning=!0):($("#break-left").removeClass("hidden"),$("#time-left").addClass("hidden"),$("#current-timer").css("background-color","#ef9a9a"),$scope.timerStates.breakRunning=!0),$scope.startClock()}function stopCurrentInterval(){$scope.timerStates.workRunning?($scope.timerStates.workRunning=!1,clearInterval(workInterval)):($scope.timerStates.breakRunning=!1,clearInterval(breakInterval))}$("#volume-switch").prop("checked",!0),$scope.rounds={roundsLeft:1,totalRounds:8},$scope.optionTimes={timeOff:"00:10",timeOn:"00:20"},$scope.timerTimes={breakTime:"00:10",workTime:"00:20"},$scope.timerStates={breakRunning:!1,workRunning:!1},$scope.changeTime=function(currentTime,deltaTime){var time=parseTime(currentTime),minutes=time[0],seconds=time[1],newTime="";if(seconds<=4&&0===minutes&&$("#volume-switch").prop("checked")&&($scope.timerStates.breakRunning||$scope.timerStates.workRunning)&&makeSound(seconds),59===seconds&&"+1"===deltaTime)newTime=(minTwoDigits(minutes+1)+":00").toString();else if(minutes>=1&&0===seconds&&"-1"===deltaTime)newTime=(minTwoDigits(minutes-1)+":59").toString();else if(0===minutes&&0===seconds&&"-1"===deltaTime)newTime=(minTwoDigits(minutes)+":"+minTwoDigits(seconds)).toString();else{var tempTime=minTwoDigits(eval(seconds+deltaTime));newTime=(minTwoDigits(minutes)+":"+tempTime).toString()}return newTime},$scope.changeRounds=function(currentRounds,deltaRounds){0===$scope.rounds.totalRounds&&"-1"===deltaRounds||($scope.rounds.totalRounds=eval(currentRounds+deltaRounds))},$scope.changeTimeOff=function(e,t){var s=$scope.changeTime(e,t);$scope.optionTimes.timeOff=s,$scope.timerTimes.breakTime=s},$scope.changeTimeOn=function(e,t){var s=$scope.changeTime(e,t);$scope.optionTimes.timeOn=s,$scope.timerTimes.workTime=s},$scope.startClock=function(){$("#pause-button").removeClass("hidden"),$("#start-button").addClass("hidden"),$("#break-left").hasClass("hidden")&&($scope.timerStates.workRunning=!0),$scope.rounds.roundsLeft<=$scope.rounds.totalRounds?$scope.timerStates.workRunning?$scope.timerStates.breakRunning||(workInterval=setInterval(function(){$scope.timerStates.workRunning=!0;var e=$scope.changeTime($scope.timerTimes.workTime,"-1");if($scope.timerTimes.workTime=e,"00:00"===e){stopCurrentInterval(),$scope.timerStates.workRunning=!1;var t=$scope.optionTimes.timeOn;$scope.timerTimes.workTime=t,$scope.$apply(),$scope.rounds.roundsLeft++,switchScreens("toBreak")}$scope.$apply()},1e3)):breakInterval=setInterval(function(){$scope.timerStates.breakRunning=!0;var e=$scope.changeTime($scope.timerTimes.breakTime,"-1");if($scope.timerTimes.breakTime=e,"00:00"===e){stopCurrentInterval(),$scope.timerStates.breakRunning=!1;var t=$scope.optionTimes.timeOff;$scope.timerTimes.breakTime=t,$scope.$apply(),switchScreens("toWork")}$scope.$apply()},1e3):($("#pause-button").addClass("hidden"),$("#start-button").removeClass("hidden"),$scope.clear())},$scope.pauseClock=function(){$("#pause-button").addClass("hidden"),$("#start-button").removeClass("hidden"),stopCurrentInterval()},$scope.clear=function(){$scope.timerTimes.breakTime=$scope.optionTimes.timeOff,$scope.timerTimes.workTime=$scope.optionTimes.timeOn,$scope.rounds.roundsLeft=1,$("#break-left").removeClass("hidden"),$("#time-left").addClass("hidden"),$("#current-timer").css("background-color","#ef9a9a"),$scope.pauseClock()}}]);